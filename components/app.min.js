// File: assets/js/app.js
function initSidebarToggler() {
  var setSidebarType = function () {
    var width = window.innerWidth > 0 ? window.innerWidth : this.screen.width;
    if (width < 1199) {
      $("#main-wrapper")
        .attr("data-sidebartype", "mini-sidebar")
        .addClass("mini-sidebar")
        .removeClass("show-sidebar");
    } else {
      $("#main-wrapper")
        .attr("data-sidebartype", "full")
        .removeClass("mini-sidebar")
        .removeClass("show-sidebar");
    }
  };

  $(window).off("resize").on("resize", setSidebarType).ready(setSidebarType);

  $(".sidebartoggler")
    .off("click")
    .on("click", function () {
      var width = window.innerWidth > 0 ? window.innerWidth : this.screen.width;

      if (width < 1199) {
        $("#main-wrapper").toggleClass("show-sidebar");
        return;
      }

      $("#main-wrapper").toggleClass("mini-sidebar");
      var isMini = $("#main-wrapper").hasClass("mini-sidebar");
      $(".sidebartoggler").prop("checked", isMini);
      $("#main-wrapper").attr(
        "data-sidebartype",
        isMini ? "mini-sidebar" : "full"
      );
    });

  if (window.__closeSidebarHandler) {
    document.removeEventListener("click", window.__closeSidebarHandler, true);
  }

  const closeSidebarOnOutsideClick = (event) => {
    var width = window.innerWidth > 0 ? window.innerWidth : this.screen.width;
    if (width >= 1199) return;

    const sidebar = document.querySelector(".left-sidebar");
    const toggler = document.querySelector(".sidebartoggler");
    if (!sidebar || !toggler) return;

    const clickedInsideSidebar = sidebar.contains(event.target);
    const clickedToggler = toggler.contains(event.target);

    if (!clickedInsideSidebar && !clickedToggler) {
      $("#main-wrapper").removeClass("show-sidebar");
    }
  };

  document.addEventListener("click", closeSidebarOnOutsideClick, true);
  window.__closeSidebarHandler = closeSidebarOnOutsideClick;
}

// Panggil saat dokumen siap
$(document).ready(initSidebarToggler);

// Ekspor fungsi untuk dipanggil ulang
window.initSidebarToggler = initSidebarToggler;
